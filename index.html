<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Firebase Connection Test (onload)</title>
    <style>
        body { font-family: sans-serif; background-color: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #status { font-size: 24px; padding: 40px; border-radius: 10px; text-align: center; }
        .connecting { background-color: #333; border: 2px solid #ffc107; }
        .success { background-color: #28a745; border: 2px solid #1f8136; }
        .error { background-color: #dc3545; border: 2px solid #a71d2a; }
    </style>
</head>
<body>

    <div id="status" class="connecting">
        <h1>جاري انتظار تحميل الصفحة بالكامل...</h1>
    </div>

    <!-- تحميل Firebase من المصدر الرسمي -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>

    <script>
        // *** التغيير الأهم: وضع كل الكود داخل window.onload ***
        window.onload = function( ) {
            
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<h1>تم تحميل الصفحة، جاري الاتصال بـ Firebase...</h1>';

            const firebaseConfig = {
                apiKey: "AIzaSyD5YAKC8KO5jKHQdsdrA8Bm-ERD6yUdHBQ",
                authDomain: "tele-follow.firebaseapp.com",
                projectId: "tele-follow",
                storageBucket: "tele-follow.firebasestorage.app",
                messagingSenderId: "311701431089",
                appId: "1:311701431089:web:fcba431dcae893a87cc610"
            };

            try {
                // الآن نحن متأكدون 100% أن كائن "firebase" موجود
                const app = firebase.initializeApp(firebaseConfig);
                const auth = firebase.auth.getAuth(app);

                firebase.auth.signInAnonymously(auth)
                    .then((userCredential) => {
                        statusDiv.className = 'success';
                        statusDiv.innerHTML = `<h1>✅ نجح الاتصال!</h1><p>تم تسجيل الدخول بنجاح.</p>`;
                    })
                    .catch((error) => {
                        statusDiv.className = 'error';
                        statusDiv.innerHTML = `<h1>❌ فشل تسجيل الدخول</h1><p>${error.message}</p>`;
                    });

            } catch (error) {
                statusDiv.className = 'error';
                statusDiv.innerHTML = `<h1>❌ فشل تهيئة Firebase</h1><p>${error.message}</p>`;
            }
        };
    </script>

</body>
</html>
