<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FoxiGrow Ultimate - Mustafa Alaa</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #050505;
            --card: rgba(255, 255, 255, 0.05);
            --primary: #ff9900;
            --secondary: #00ffcc;
            --border: rgba(255, 255, 255, 0.1);
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: #fff; padding-bottom: 100px; overflow-x: hidden; }
        
        /* Header */
        .header { padding: 20px; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); border-bottom: 1px solid var(--border); }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(45deg, var(--primary), #ff4d00); display: flex; align-items: center; justify-content: center; font-weight: 800; border: 2px solid var(--border); font-size: 1.2rem; }
        .lvl-tag { background: rgba(255,153,0,0.1); border: 1px solid var(--primary); color: var(--primary); padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; margin-top: 4px; display: inline-block; }

        /* Stats Card */
        .stats-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; }
        .stat-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px 5px; text-align: center; backdrop-filter: blur(10px); }
        .stat-card.active { border-color: var(--primary); box-shadow: 0 0 15px rgba(255,153,0,0.1); }
        .stat-card .val { font-size: 1.2rem; font-weight: 800; display: block; margin-bottom: 4px; }
        .stat-card .label { font-size: 0.65rem; color: #888; }

        /* Clicker Area */
        .clicker-section { display: flex; flex-direction: column; align-items: center; margin: 20px 0; }
        .coin-wrapper { position: relative; width: 240px; height: 240px; }
        .coin-btn { width: 100%; height: 100%; border-radius: 50%; background: radial-gradient(circle at 35% 35%, #ffd000, #ff9900); border: 10px solid rgba(255,255,255,0.05); cursor: pointer; transition: transform 0.05s ease-in-out; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 60px rgba(255,153,0,0.3); }
        .coin-btn:active { transform: scale(0.95); }
        .coin-btn img { width: 110px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.2)); }

        /* Energy Bar */
        .energy-box { width: 80%; margin-top: 20px; text-align: center; }
        .energy-bar { height: 12px; background: rgba(255,255,255,0.1); border-radius: 10px; margin-top: 8px; overflow: hidden; border: 1px solid var(--border); }
        .energy-fill { height: 100%; width: 100%; background: linear-gradient(90deg, #ff9900, #ffd000); transition: width 0.3s; }

        /* Navigation */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(10,10,10,0.98); display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid var(--border); z-index: 1000; }
        .nav-btn { color: #666; font-size: 0.75rem; text-align: center; flex: 1; cursor: pointer; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); transform: translateY(-3px); }
        .nav-btn i { font-size: 1.6rem; display: block; margin-bottom: 5px; }

        /* Modals (Full Screen) */
        .modal { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; flex-direction: column; padding: 25px; overflow-y: auto; }
        .modal.active { display: flex; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .btn-close { background: var(--card); border: 1px solid var(--border); color: #fff; padding: 8px 15px; border-radius: 10px; }

        /* Elements */
        .item-row { background: var(--card); border: 1px solid var(--border); border-radius: 15px; padding: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .btn-buy { background: var(--primary); border: none; color: #fff; padding: 8px 15px; border-radius: 10px; font-weight: bold; }
        .btn-buy.disabled { background: #333; color: #777; }

        #loading-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .float-text { position: absolute; font-weight: 900; font-size: 1.8rem; pointer-events: none; animation: floatUp 0.8s ease-out forwards; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-120px); opacity: 0; } }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div style="width: 50px; height: 50px; border: 4px solid #222; border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear;"></div>
        <p style="margin-top: 20px; font-weight: bold;">FoxiGrow Pro V.Final</p>
    </div>

    <div id="home-view">
        <div class="header">
            <div class="user-info">
                <div class="avatar" id="avatar">M</div>
                <div>
                    <h4 id="username">Mustafa Alaa</h4>
                    <span class="lvl-tag" id="level-label">Ù…Ø¨ØªØ¯Ø¦ â€¢ Level 1</span>
                </div>
            </div>
            <div onclick="openModal('shop-modal')" style="font-size: 1.5rem; cursor: pointer;">ğŸ›’</div>
        </div>

        <div class="stats-box">
            <div class="stat-card">
                <span class="val" id="ref-count">0</span>
                <span class="label">Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</span>
            </div>
            <div class="stat-card active">
                <span class="val" id="fg-balance" style="color: var(--primary);">0.00</span>
                <span class="label">FG Coin</span>
            </div>
            <div class="stat-card">
                <span class="val" id="usdt-balance" style="color: var(--secondary);">0.00</span>
                <span class="label">USDT</span>
            </div>
        </div>

        <div class="clicker-section">
            <div class="coin-wrapper">
                <div class="coin-btn" onpointerdown="doTap(event)">
                    <img src="https://cdn-icons-png.flaticon.com/512/217/217853.png" alt="Coin">
                </div>
            </div>
            <div class="energy-box">
                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #888;">
                    <span>âš¡ Ø§Ù„Ø·Ø§Ù‚Ø©</span>
                    <span id="energy-text">1000 / 1000</span>
                </div>
                <div class="energy-bar">
                    <div class="energy-fill" id="energy-fill"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="shop-modal" class="modal">
        <div class="modal-header">
            <h3>Ø§Ù„Ù…ØªØ¬Ø± ğŸ›’</h3>
            <button class="btn-close" onclick="closeModal('shop-modal')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div class="item-row">
            <div>
                <h4>Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ù‚ØµÙˆÙ‰</h4>
                <p style="font-size: 0.7rem; color: #888;">+500 Ø·Ø§Ù‚Ø© Ø¥Ø¶Ø§ÙÙŠØ©</p>
            </div>
            <button class="btn-buy" onclick="buyItem('energy', 5000)">5000 FG</button>
        </div>
        <div class="item-row">
            <div>
                <h4>Ø±ØµÙŠØ¯ 1.00 USDT</h4>
                <p style="font-size: 0.7rem; color: #888;">ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Ù‚Ø§Ø· Ù„Ø¹Ù…Ù„Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©</p>
            </div>
            <button class="btn-buy" onclick="buyItem('usdt', 50000)">50,000 FG</button>
        </div>
    </div>

    <div id="tasks-modal" class="modal">
        <div class="modal-header">
            <h3>Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ¯</h3>
            <button class="btn-close" onclick="closeModal('tasks-modal')">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
        <div id="tasks-list">
            <div class="item-row">
                <div>
                    <h4>Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù‚Ù†Ø§ØªÙ†Ø§</h4>
                    <p style="font-size: 0.7rem; color: #888;">Ø§Ø±Ø¨Ø­ +1000 FG</p>
                </div>
                <button class="btn-buy" onclick="completeTask(1000, 'https://t.me/tofe109tofebot')">GO</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-btn active" onclick="closeAll()"><i>ğŸ </i>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
        <div class="nav-btn" onclick="openModal('tasks-modal')"><i>ğŸ¯</i>Ø§Ù„Ù…Ù‡Ø§Ù…</div>
        <div class="nav-btn" onclick="openModal('shop-modal')"><i>ğŸ›’</i>Ø§Ù„Ù…ØªØ¬Ø±</div>
        <div class="nav-btn" onclick="shareRef()"><i>ğŸ</i>Ø¯Ø¹ÙˆØ©</div>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, increment, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyD5YAKC8KO5jKHQdsdrA8Bm-ERD6yUdHBQ",
            authDomain: "tele-follow.firebaseapp.com",
            projectId: "tele-follow",
            storageBucket: "tele-follow.firebasestorage.app",
            messagingSenderId: "311701431089",
            appId: "1:311701431089:web:fcba431dcae893a87cc610"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const tg = window.Telegram.WebApp;

        let userId = tg.initDataUnsafe?.user?.id?.toString() || "dev_mustafa";
        const userRef = doc(db, "users", userId);
        let userState = { energy: 1000, maxEnergy: 1000, balance: 0 };

        async function init() {
            const snap = await getDoc(userRef);
            if (!snap.exists()) {
                await setDoc(userRef, {
                    name: tg.initDataUnsafe?.user?.first_name || "Mustafa",
                    balance_fg: 0,
                    balance_usdt: 0,
                    energy: 1000,
                    max_energy: 1000,
                    level: 1,
                    friends: 0
                });
                checkRef();
            }

            onSnapshot(userRef, (d) => {
                const data = d.data();
                userState.balance = data.balance_fg;
                userState.maxEnergy = data.max_energy;
                document.getElementById('fg-balance').innerText = data.balance_fg.toLocaleString();
                document.getElementById('usdt-balance').innerText = data.balance_usdt.toFixed(2);
                document.getElementById('username').innerText = data.name;
                document.getElementById('avatar').innerText = data.name.charAt(0);
                document.getElementById('ref-count').innerText = data.friends || 0;
                document.getElementById('level-label').innerText = `Level ${data.level} â€¢ ${data.level > 5 ? 'Ù…Ø­ØªØ±Ù' : 'Ù…Ø¨ØªØ¯Ø¦'}`;
            });

            startEnergyRegen();
            document.getElementById('loading-screen').style.display = 'none';
        }

        window.doTap = async (e) => {
            if (userState.energy <= 0) return;
            
            userState.energy -= 1;
            updateEnergyUI();
            createFloat(e.clientX, e.clientY);
            tg.HapticFeedback.impactOccurred('light');

            await updateDoc(userRef, { balance_fg: increment(0.2) });
        };

        function updateEnergyUI() {
            const pct = (userState.energy / userState.maxEnergy) * 100;
            document.getElementById('energy-fill').style.width = pct + "%";
            document.getElementById('energy-text').innerText = `${userState.energy} / ${userState.maxEnergy}`;
        }

        function startEnergyRegen() {
            setInterval(() => {
                if (userState.energy < userState.maxEnergy) {
                    userState.energy += 1;
                    updateEnergyUI();
                }
            }, 2000);
        }

        window.buyItem = async (type, price) => {
            if (userState.balance < price) return tg.showAlert("Ø±ØµÙŠØ¯Ùƒ ØºÙŠØ± ÙƒØ§ÙÙ!");
            
            if (type === 'energy') {
                await updateDoc(userRef, { balance_fg: increment(-price), max_energy: increment(500) });
            } else if (type === 'usdt') {
                await updateDoc(userRef, { balance_fg: increment(-price), balance_usdt: increment(1.0) });
            }
            tg.showAlert("ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!");
        };

        window.shareRef = () => {
            const link = `https://t.me/tofe109tofebot?start=ref_${userId}`;
            tg.openTelegramLink(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent("Ø§Ù†Ø¶Ù… Ø¥Ù„ÙŠÙ‘ ÙÙŠ FoxiGrow ÙˆØ§Ø¨Ø¯Ø£ Ø¨Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª!")}`);
        };

        async function checkRef() {
            const start = tg.initDataUnsafe?.start_param;
            if (start?.startsWith('ref_')) {
                const inviter = start.split('_')[1];
                if (inviter !== userId) {
                    await updateDoc(doc(db, "users", inviter), { balance_fg: increment(5000), friends: increment(1) });
                    await updateDoc(userRef, { balance_fg: increment(2000) });
                }
            }
        }

        function createFloat(x, y) {
            const el = document.createElement('div');
            el.className = 'float-text';
            el.style.left = x + 'px'; el.style.top = y + 'px';
            el.innerText = "+0.2";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        window.openModal = (id) => document.getElementById(id).classList.add('active');
        window.closeModal = (id) => document.getElementById(id).classList.remove('active');
        window.closeAll = () => document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));

        tg.ready(); tg.expand(); init();
    </script>
    <style>@keyframes spin { 100% { transform: rotate(360deg); } }</style>
</body>
</html>
